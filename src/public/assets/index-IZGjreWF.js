import{ao as M,a as o,an as e,aC as G}from"./index-ewVy9M9d.js";import{u as Z,b as J,c as Q,T as U,e as ee,s as oe,f as le,g as re,h as ie,i as ce,U as de,D as X}from"./ErpApp-7Wu0aHhn.js";import{aO as W,aH as V,aM as te,b2 as $,aU as Y,aV as b,B as O,aK as z,a_ as ue,ax as pe,aP as w,aX as me,aZ as xe}from"./IdurarOs-eHlzvnv3.js";import{P as K}from"./index-Rolmm9vx.js";import{I as q}from"./infocard-1l-rLQd8.js";import{T as he}from"./index-_ks-rlOi.js";import{C as ye}from"./index-VpG7vA6I.js";import{l as ge}from"./config--HMVr5hr.js";import"./Skeleton-a_sn-oBg.js";function be({config:a,getTableData:f,extra:T=[]}){let{lunchEntity:d,dataTableColumns:c,lunchFields:r}=a;const[i]=W.useForm(),u=V(),{moneyFormatter:p}=Z(),{dateFormat:m}=J(),x=M(te),[C,v]=o.useState([]),[h,y]=o.useState(""),[g,k]=o.useState([]),j=t=>t.userId._id===h,N=()=>{const t=new Date,s=new Date(t);s.setDate(t.getDate()-t.getDay()-6),s.setUTCHours(0,0,0,0);const l=new Date(t);return l.setDate(s.getDate()+6),{startDate:s,endDate:l}},A=({editing:t,dataIndex:s,title:l,inputType:P,record:I,index:B,children:se,...ne})=>{const ae=P==="number"?e.jsx(ue,{}):e.jsx(pe,{});return e.jsx("td",{...ne,children:t?e.jsx(W.Item,{name:s,style:{margin:0},rules:[{required:!0,message:`Please Input ${l}!`}],children:ae}):se})},L=t=>{i.setFieldsValue({mon:"",tue:"",wed:"",thu:"",fri:"",sat:"",sun:"",...t}),y(t.userId._id)},R=()=>{y("")},E=async t=>{try{const l=await i.validateFields(),P=t._id;await z.update({entity:d,id:P,jsonData:l}),y(""),i.resetFields(),F()}catch(s){console.log("Validate Failed:",s)}};let D=[];r?D=[...Q({fields:r,translate:u,moneyFormatter:p,dateFormat:m})]:D=[...c],c=[...D,{title:"Action",key:"operation",width:140,render:(t,s)=>j(s)?e.jsxs("span",{children:[e.jsx($.Link,{onClick:()=>E(s),style:{marginRight:8},children:"Save"}),e.jsx(K,{title:"Sure to cancel?",onConfirm:R,children:e.jsx("a",{children:"Cancel"})})]}):e.jsx($.Link,{disabled:h!=="",onClick:()=>L(s),children:"Edit"})},U.SELECTION_COLUMN],x.role!="owner"&&(c=c.filter(t=>t.key!=="operation"));const F=async()=>{const t=N(),s={userId:x._id,startDate:t.startDate,endDate:t.endDate},l=await z.list({entity:d,options:s});console.log(l),f(l==null?void 0:l.result),k(l==null?void 0:l.result)};o.useEffect(()=>{const t=new AbortController;return F(),()=>{t.abort()}},[]);const _={onChange:(t,s)=>{v(s)},getCheckboxProps:t=>({})},S=c.map(t=>!t||!t.editable?t:{...t,onCell:s=>({record:s,inputType:"number",dataIndex:t.dataIndex,title:t.title,editing:j(s)})}),n=async()=>{try{const t={selectedRows:C,type:"approved",recipient:x._id};await z.updateAll({entity:d,jsonData:t}),F()}catch(t){console.log("Validate Failed:",t)}};return e.jsx(e.Fragment,{children:e.jsxs(W,{form:i,component:!1,children:[e.jsx(Y,{justify:"end",className:"pb-4",children:e.jsx(b,{span:2,children:e.jsx(K,{title:"Confirm",description:"Are you sure to confirm these?",okText:"Yes",cancelText:"No",okButtonProps:{className:"bg-teal-300"},onConfirm:n,children:e.jsx(O,{className:"bg-teal-300 text-[white] mr-5",disabled:C.length===0,children:u("Confirm")})})})}),e.jsx(U,{components:{body:{cell:A}},rowSelection:{..._,type:"checkbox"},columns:S,rowKey:t=>t.userId._id,dataSource:g,rowClassName:"editable-row",scroll:{x:!0}})]})})}function fe({config:a,selectedListItems:f,handelDataTableLoad:T,approve:d,declien:c,currentStatus:r,extra:i=[]}){let{dataTableColumns:u,fields:p,entity:m}=a;const x=V(),C=G(),{moneyFormatter:v}=Z(),{dateFormat:h}=J(),[y,g]=o.useState([]);o.useState("");const{crudContextAction:k}=ee(),{collapsedBox:j,panel:N,editBox:A}=k,{result:L,isLoading:R}=f,{pagination:E,items:D}=L,[F,_]=o.useState();let S=[];p?S=[...Q({fields:p,translate:x,moneyFormatter:v,dateFormat:h})]:S=[...u],o.useEffect(()=>{_(D),g([])},[D]);const n=I=>{C(w.currentItem({data:I})),C(w.currentAction({actionType:"update",data:I})),A.open(),N.open(),j.open()};u=[...S,{title:"Action",key:"operation",render:(I,B)=>e.jsx($.Link,{disabled:r!=="pending",onClick:()=>n(B),children:"Edit"})},U.SELECTION_COLUMN];const t={onChange:(I,B)=>{g(B)},getCheckboxProps:I=>({})},s=()=>{d(y),g([])},l=()=>{c(y),g([])},P=()=>{N.open(),j.close()};return e.jsxs(e.Fragment,{children:[e.jsxs(Y,{justify:"start",className:"pb-4",children:[e.jsx(b,{span:2,children:(m==="payment"||m==="income")&&e.jsx(O,{className:"bg-teal-300 text-[white]",onClick:P,disabled:r!=="pending",children:x("Create")})}),e.jsxs(b,{span:22,children:[" ",e.jsxs("div",{style:{display:"flex",justifyContent:"flex-end"},children:[e.jsx(K,{title:"Decline",description:"Are you sure to decline these?",okText:"Yes",cancelText:"No",okButtonProps:{className:"bg-teal-300"},onConfirm:l,children:e.jsx(O,{className:"bg-orange-400 text-[white] mr-5",disabled:r!=="pending"||y.length===0,children:x("Decline")})}),e.jsx(K,{title:"Approve",description:"Are you sure to approve these?",okText:"Yes",cancelText:"No",okButtonProps:{className:"bg-teal-300"},onConfirm:s,children:e.jsx(O,{className:"bg-green-300 text-[white]",disabled:r!=="pending"||y.length===0,children:x("Approve")})})]})]})]}),e.jsx(U,{columns:u,rowKey:(I,B)=>I._id,rowSelection:r==="pending"?{...t,type:"checkbox"}:null,dataSource:F,pagination:E,loading:R,onChange:T,scroll:{x:!0}})]})}const Ce=[{key:"pending",label:"PENDING"},{key:"approved",label:"APPROVED"},{key:"decliend",label:"DECLINED"}];function je({config:a,formElements:f,withUpload:T}){const d=V(),{crudContextAction:c,state:r}=ee(),{deleteModalLabels:i}=a,{modal:u,editBox:p,collapsedBox:m,panel:x}=c,{isReadBoxOpen:C,isEditBoxOpen:v}=r,{result:h}=M(ie),y=G(),[g,k]=o.useState("");o.useEffect(()=>{if(h){const A=i.map(L=>h[L]).join(" ");k(A)}},[h]);const j=()=>{y(w.currentAction({actionType:"update",data:h})),p.open()},N=C||v?{opacity:1}:{opacity:0};return e.jsxs(e.Fragment,{children:[e.jsxs(Y,{style:N,gutter:24,children:[e.jsx(b,{span:10,children:e.jsx("p",{style:{marginBottom:"10px"},children:g})}),e.jsx(b,{span:14,children:e.jsx(O,{onClick:j,type:"text",icon:e.jsx(xe,{}),size:"small",style:{float:"right",marginLeft:"0px",marginTop:"10px"},children:d("edit")})}),e.jsx(b,{span:24,children:e.jsx("div",{className:"line"})}),e.jsx("div",{className:"space10"})]}),e.jsx(ce,{config:a}),e.jsx(de,{config:a,formElements:f,withUpload:T})]})}const Te=({config:a,createForm:f,updateForm:T,lunchConfig:d,withUpload:c=!1})=>{let{entity:r}=a;const i=G();o.useLayoutEffect(()=>{i(w.resetState())},[]);const u=M(te),p=M(oe);console.log(p);const[m,x]=o.useState("pending"),[C,v]=o.useState(0),[h,y]=o.useState("0h 0m"),[g,k]=o.useState("0h 0m"),[j,N]=o.useState("0h 0m"),[A,L]=o.useState([1,2]),R=n=>{const t={page:n.current||1,items:n.pageSize||10,filter:"status",equal:m,userId:u};i(w.list({entity:r,options:t}))},E=()=>{const n={filter:"status",equal:m,userId:u._id};i(w.list({entity:r,options:n}))};o.useEffect(()=>{const n=new AbortController;return E(),()=>{n.abort()}},[m]);const D=async n=>{if(n.length>0){const t={selectedRows:n,type:"approved"};i(w.updateAll({entity:r,jsonData:t})),E()}else E()},F=async n=>{if(n.length>0){const t={selectedRows:n,type:"decliend"};i(w.updateAll({entity:r,jsonData:t})),E()}},_=n=>{console.log(n),L(n)},S=n=>{x(n)};return e.jsxs(e.Fragment,{children:[e.jsx(he,{defaultActiveKey:"pending",items:Ce,onChange:S}),e.jsxs(Y,{gutter:16,style:{marginBottom:"16px",marginTop:"32px"},children:[e.jsx(b,{span:6,children:e.jsx(q,{label:"TOTAL COUNTS",value:C})}),e.jsx(b,{span:6,children:e.jsx(q,{label:"PRODUCTIVE TIME",value:h})}),e.jsx(b,{span:6,children:e.jsx(q,{label:"UNPRODUCTIVE TIME",value:g})}),e.jsx(b,{span:6,children:e.jsx(q,{label:"NEUTRAL TIME",value:j})})]}),e.jsx(le,{config:a,sidePanelBottomContent:e.jsx(re,{config:a,formElements:f,withUpload:c}),sidePanelTopContent:e.jsx(je,{config:a,formElements:T,withUpload:c}),children:e.jsx(fe,{config:a,handelDataTableLoad:R,selectedListItems:p,approve:D,declien:F,currentStatus:m})}),A.length>0&&m==="pending"&&e.jsxs(e.Fragment,{children:[e.jsx(me,{className:"my-3"}),e.jsx(ye,{children:e.jsx(be,{config:d,getTableData:_})})]})]})},Ee=Te,H={userId:{label:"Created By",type:"avatar",required:!0,disableForForm:!0,entity:"admin",displayLabels:["firstname","lastname"],dataIndex:["people","firstname"],searchFields:"firstname,lastname",feedback:"people"},recipient:{label:"Recipient",type:"avatar",required:!0,entity:"admin",redirectLabel:"Add New People",withRedirect:!0,urlToRedirect:"/members",displayLabels:["firstname","lastname"],searchFields:"firstname,lastname",dataIndex:["people","firstname"],feedback:"people"},created:{label:"Date",type:"date",disableForForm:!0},expenseCategory:{label:"Expense Category",type:"async",displayLabels:["expenseCategory","name"],dataIndex:["expenseCategory","name"],entity:"expensecategory",required:!0,redirectLabel:"Add New Category",withRedirect:!0,urlToRedirect:"/categoryexpenses"},comment:{label:"Comment",type:"string",required:!0},amount:{label:"Amount",type:"amount"},status:{label:"Status",default:"pending",disableForForm:!0},type:{label:"Type",type:"select",required:!0,defaultValue:"Request",options:[{value:"Request",label:"Request"},{value:"Company Expenses",label:"Company Expenses"}]}};function ke(){const a=V(),f="payment",T={displayLabels:["name"],searchFields:"comment"},d=["name"],c={PANEL_TITLE:a("Expenses"),DATATABLE_TITLE:a("expenses_list"),ADD_NEW_ENTITY:a("add_new_expense"),ENTITY_NAME:a("expenses")},i={...{entity:f,...c},fields:H,searchConfig:T,deleteModalLabels:d},p={lunchEntity:"lunch",lunchFields:ge};return e.jsx(e.Fragment,{children:e.jsx(Ee,{createForm:e.jsx(X,{fields:H}),updateForm:e.jsx(X,{fields:H}),config:i,lunchConfig:p})})}export{ke as default};
