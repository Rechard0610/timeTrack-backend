import{aB as w,aC as D,ao as U,a as c,an as e,aK as B,aS as I}from"./index-ewVy9M9d.js";import{aH as L,aO as E,aQ as M,B as C,aU as F,aV as T,aX as S,b3 as R}from"./IdurarOs-eHlzvnv3.js";import{d as k,u as v,n as O,p as P,o as A,z as Y}from"./ErpApp-7Wu0aHhn.js";import{E as N}from"./index-IjoPjNv1.js";import{e as h}from"./actions-cTR2S2ig.js";import{h as H,s as z}from"./selectors-c3wjZmkY.js";import{c as g}from"./calculate-2yTKWIus.js";import{P as K,F as Q}from"./PaymentForm-exIYBEfe.js";import{t as $}from"./statusTagColor-sG5xH6CK.js";import{D as l}from"./index-TnfYKfV7.js";import{C as V}from"./CloseCircleOutlined-QfALGiz_.js";function W({config:n,currentInvoice:s}){const a=L(),o=w();let{entity:d}=n;const r=D(),{isLoading:m,isSuccess:t}=U(H),[p]=E.useForm(),[j,_]=c.useState(0);c.useEffect(()=>{if(s){const{credit:i,total:y,discount:x,amount:b}=s;_(g.sub(g.sub(y,x),g.sub(g.sub(i,b))));const u={...s};u.date&&(u.date=k(u.date)),p.setFieldsValue(u)}},[s]),c.useEffect(()=>{t&&(p.resetFields(),r(h.resetAction({actionType:"recordPayment"})),r(h.list({entity:d})),o(`/${d.toLowerCase()}/read/${s._id}`))},[t]);const f=i=>{if(s){const{_id:y}=s,x=s.client&&s.client._id;i={...i,invoice:y,client:x}}r(h.update({entity:d,id:s._id,jsonData:i}))};return e.jsx(e.Fragment,{children:e.jsx(M,{isLoading:m,children:e.jsxs(E,{form:p,layout:"vertical",onFinish:f,children:[e.jsx(K,{maxAmount:j}),e.jsx(E.Item,{children:e.jsx(C,{type:"primary",htmlType:"submit",children:a("Update")})})]})})})}function X({config:n,currentItem:s}){var f,i;const a=L(),{entity:o,ENTITY_NAME:d}=n,r=v(),m=w(),[t,p]=c.useState(s);c.useEffect(()=>{const y=new AbortController;if(s){const{invoice:x,_id:b,...u}=s;p({...u,...x,_id:b})}return()=>y.abort()},[s]);const[j,_]=c.useState({});return c.useEffect(()=>{t!=null&&t.client&&_(t.client[t.client.type])},[t]),e.jsxs(e.Fragment,{children:[e.jsx(F,{gutter:[12,12],children:e.jsxs(T,{className:"gutter-row",xs:{span:24},sm:{span:24},md:{span:24},lg:{span:20,push:2},children:[e.jsx(O,{onBack:()=>m(`/${o.toLowerCase()}`),title:`Update  ${d} # ${t.number}/${t.year||""}`,ghost:!1,tags:e.jsx(P,{color:(f=$(t.paymentStatus))==null?void 0:f.color,children:t.paymentStatus}),extra:[e.jsx(C,{onClick:()=>{m(`/${o.toLowerCase()}`)},icon:e.jsx(V,{}),children:a("Cancel")},`${A.generate()}`),e.jsx(C,{onClick:()=>m(`/invoice/read/${t._id}`),icon:e.jsx(Q,{}),children:a("Show invoice")},`${A.generate()}`)],style:{padding:"20px 0px"}}),e.jsx(S,{dashed:!0})]})}),e.jsxs(F,{gutter:[12,12],children:[e.jsxs(T,{className:"gutter-row",xs:{span:24,order:2},sm:{span:24,order:2},md:{span:10,order:2,push:2},lg:{span:10,order:2,push:4},children:[e.jsx("div",{className:"space50"}),e.jsxs(l,{title:`${a("Client")} : ${t.client.name}`,column:1,children:[e.jsx(l.Item,{label:a("email"),children:j.email}),e.jsx(l.Item,{label:a("Phone"),children:j.phone}),e.jsx(S,{dashed:!0}),e.jsx(l.Item,{label:a("Payment Status"),children:e.jsx(P,{color:(i=$(t.paymentStatus))==null?void 0:i.color,children:t.paymentStatus})}),e.jsx(l.Item,{label:a("SubTotal"),children:r.moneyFormatter({amount:t.subTotal,currency_code:t.currency})}),e.jsx(l.Item,{label:a("Total"),children:r.moneyFormatter({amount:t.total,currency_code:t.currency})}),e.jsx(l.Item,{label:"Discount",children:r.moneyFormatter({amount:t.discount,currency_code:t.currency})}),e.jsx(l.Item,{label:"Balance",children:r.moneyFormatter({amount:t.credit,currency_code:t.currency})})]})]}),e.jsx(T,{className:"gutter-row",xs:{span:24,order:1},sm:{span:24,order:1},md:{span:12,order:1},lg:{span:10,order:1,push:2},children:e.jsx(W,{config:n,currentInvoice:t})})]})]})}function q({config:n}){const s=D(),{id:a}=B();c.useLayoutEffect(()=>{s(h.read({entity:n.entity,id:a}))},[a]);const{result:o,isSuccess:d,isLoading:r=!0}=U(z),m=t=>{s(Y.updateCurrency({data:{default_currency_code:t}}))};return c.useLayoutEffect(()=>{o&&(s(h.currentAction({actionType:"update",id:a,data:o})),m(o.currency))},[o]),r?e.jsx(N,{children:e.jsx(I,{})}):e.jsx(N,{children:d?e.jsx(X,{config:n,currentItem:o}):e.jsx(R,{entity:n.entity})})}function ie(){const n=L(),s="payment",a={PANEL_TITLE:n("payment"),DATATABLE_TITLE:n("payment_list"),ADD_NEW_ENTITY:n("add_new_payment"),ENTITY_NAME:n("payment")},o={entity:s,...a};return e.jsx(q,{config:o})}export{ie as default};
