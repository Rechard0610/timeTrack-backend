import{a as i,an as e,aC as te,ao as G}from"./index-ewVy9M9d.js";import{u as xe,b as be,e as se,c as he,T as X,d as ge,s as fe,f as je,g as Te,h as Ie,i as Ce,U as ye}from"./ErpApp-7Wu0aHhn.js";import{aH as ae,ai as ve,S as Se,aU as Z,aV as f,B as K,ax as Ee,aP as E,aM as Ne,aZ as ke}from"./IdurarOs-eHlzvnv3.js";import{P as ee}from"./index-Rolmm9vx.js";import{T as _e}from"./index-_E_Oz9gG.js";import{I as z}from"./infocard-1l-rLQd8.js";import{T as Ae}from"./index-_ks-rlOi.js";const De=[{label:"Productive",value:"Productive"},{label:"Neutral",value:"Neutral"},{label:"Unproductive",value:"Unproductive"}];function Pe({config:u,selectedListItems:P,handelDataTableLoad:B,approve:_,declien:c,currentStatus:o,extra:L=[]}){let{dataTableColumns:m,fields:A,entity:N}=u;const j=ae(),{moneyFormatter:T}=xe(),{dateFormat:w}=be(),[r,g]=i.useState([]);i.useState("");const{crudContextAction:R}=se(),{collapsedBox:O,panel:M}=R,{result:V,isLoading:U}=P,{pagination:$,items:F}=V,[I,D]=i.useState(),[H,q]=i.useState([]),a=t=>{const n=Math.floor(t/3600),l=Math.floor(t%3600/60),p=n===0?"00:":`${n}:`,C=`${l}`;return`${p}${C}`},x=({editing:t,dataIndex:n,title:l,record:p,index:C,children:d,...b})=>{const s={...p};let y;const v=(h,J)=>{if(l==="Percentage"){s.percentage=h.target.value;const S=s.totalTimeRange/100*Number(h.target.value);s.billabletime=a(S)}else{s.billabletime=J;const[S,pe]=J.split(":"),ue=parseInt(S,10),me=parseInt(pe,10),Q=ue*3600+me*60,W=s.totalTimeRange-s.totalTimeRange%60;s.percentage=Q*100/W!=0?(Q*100/W).toFixed(2):0}const ce=I.map(S=>S._id.userId===s._id.userId&&S._id.projectId===s._id.projectId&&S._id.taskId===s._id.taskId?s:S);D(ce)},k=s&&s.billabletime;return y=l==="Percentage"?e.jsx(Ee,{onBlur:v,defaultValue:s&&s.percentage===void 0?0:String(s.percentage),style:{width:90},suffix:"%",disabled:o!="pending"}):e.jsx(_e,{onChange:v,defaultValue:k!==void 0?ge(k,"HH:mm"):null,style:{width:90},format:"HH:mm",showNow:!1,needConfirm:!1,disabled:o!="pending"}),e.jsx("td",{...b,children:t?y:d})};let Y=[];A?Y=[...he({fields:A,translate:j,moneyFormatter:T,dateFormat:w})]:Y=[...m];const ne=(t,n)=>{let l=I;if(r.length>0){const p=r.map(C=>C._id===n._id?{...C,productive:t}:C);g(p)}l=l.map(p=>(console.log(p),console.log(n),console.log(t),p._id===n._id?{...p,productive:t}:p)),console.log(l),D(l)};i.useEffect(()=>{q(F),D(F),g([])},[F]),m=[...Y,{title:"Productive",key:"operation",render:(t,n)=>e.jsx(ve,{size:"middle",children:e.jsx(Se,{variant:!1,size:"middle",defaultValue:n.productive,style:{width:130},disabled:o!=="pending",options:De,onChange:l=>ne(l,n)})})},X.SELECTION_COLUMN],N!=="manualtime"&&(m=m.filter(t=>t.key!=="operation"),m=m.map(t=>t.editable?{...t,onCell:n=>({record:n,dataIndex:t.dataIndex,title:t.title,editing:t.editable})}:t));const le={body:{cell:x}},oe={onChange:(t,n)=>{if(N==="weeklytime"){const l={};n.map(d=>{const b=d._id.projectId;let s=0;if(d.billabletime!=null){const[y,v]=d.billabletime.split(":"),k=parseInt(y,10),h=parseInt(v,10);s=k*3600+h*60}l[b]=(l[b]||0)+s});const p=I.map((d,b)=>{const s=d._id.projectId;let y=H[b].totalBillableTime;const v=(l[s]||0)+y;return{...d,totalBillableTime:v}}),C=n.map(d=>{var k;const b=d._id.projectId,s=d._id.taskId,y=d._id.userId,v=((k=H.find(h=>h._id.projectId===b&&h._id.userId===y&&h._id.taskId===s))==null?void 0:k.totalBillableTime)||0;if(l[b]!==void 0){const h=(l[b]||0)+v;return{...d,totalBillableTime:h}}return d});D(p),g(C)}else g(n)},getCheckboxProps:t=>({})},ie=()=>{_(r),g([])},re=()=>{c(r),g([])},de=()=>{M.open(),O.close()};return e.jsxs(e.Fragment,{children:[e.jsxs(Z,{justify:"start",className:"pb-4",children:[e.jsx(f,{span:2,children:(N==="payment"||N==="income")&&e.jsx(K,{className:"bg-teal-300 text-[white]",onClick:de,children:j("Create")})}),e.jsxs(f,{span:22,children:[" ",e.jsxs("div",{style:{display:"flex",justifyContent:"flex-end"},children:[e.jsx(ee,{title:"Decline",description:"Are you sure to decline these?",okText:"Yes",cancelText:"No",okButtonProps:{className:"bg-teal-300"},onConfirm:re,children:e.jsx(K,{className:"bg-orange-400 text-[white] mr-5",disabled:o!=="pending"||r.length===0,children:j("Decline")})}),e.jsx(ee,{title:"Approve",description:"Are you sure to approve these?",okText:"Yes",cancelText:"No",okButtonProps:{className:"bg-teal-300"},onConfirm:ie,children:e.jsx(K,{className:"bg-green-300 text-[white]",disabled:o!=="pending"||r.length===0,children:j("Approve")})})]})]})]}),e.jsx(X,{components:le,columns:m,rowKey:(t,n)=>N==="weeklytime"?`${t._id.userId}${t.totalTimeRange}-${n}`:t._id,rowSelection:o==="pending"?{...oe,type:"checkbox"}:null,dataSource:I,pagination:$,loading:U,onChange:B,scroll:{x:!0}})]})}const Be=[{key:"pending",label:"PENDING"},{key:"approved",label:"APPROVED"},{key:"decliend",label:"DECLINED"}];function Le({config:u,formElements:P,withUpload:B}){const _=ae(),{crudContextAction:c,state:o}=se(),{deleteModalLabels:L}=u,{modal:m,editBox:A,collapsedBox:N,panel:j}=c,{isReadBoxOpen:T,isEditBoxOpen:w}=o,{result:r}=G(Ie),g=te(),[R,O]=i.useState("");i.useEffect(()=>{if(r){console.log(r);const U=L.map($=>r[$]).join(" ");O(U)}},[r]);const M=()=>{g(E.currentAction({actionType:"update",data:r})),A.open()},V=T||w?{opacity:1}:{opacity:0};return e.jsxs(e.Fragment,{children:[e.jsxs(Z,{style:V,gutter:24,children:[e.jsx(f,{span:10,children:e.jsx("p",{style:{marginBottom:"10px"},children:R})}),e.jsx(f,{span:14,children:e.jsx(K,{onClick:M,type:"text",icon:e.jsx(ke,{}),size:"small",style:{float:"right",marginLeft:"0px",marginTop:"10px"},children:_("edit")})}),e.jsx(f,{span:24,children:e.jsx("div",{className:"line"})}),e.jsx("div",{className:"space10"})]}),e.jsx(Ce,{config:u}),e.jsx(ye,{config:u,formElements:P,withUpload:B})]})}const we=({config:u,createForm:P,updateForm:B,withUpload:_=!1})=>{let{entity:c}=u;const o=te();i.useLayoutEffect(()=>{o(E.resetState())},[]);const L=G(Ne),m=G(fe),{result:A}=m,{pagination:N,items:j}=A,[T,w]=i.useState("pending"),[r,g]=i.useState(0),[R,O]=i.useState("0h 0m"),[M,V]=i.useState("0h 0m"),[U,$]=i.useState("0h 0m"),F=i.useCallback(a=>{const x={page:a.current||1,items:a.pageSize||10,filter:"status",equal:T,userId:L};o(E.list({entity:c,options:x}))},[]),I=()=>{const a={filter:"status",equal:T,userId:L._id};o(E.list({entity:c,options:a}))};i.useEffect(()=>{const a=new AbortController;return I(),()=>{a.abort()}},[T]),i.useEffect(()=>{console.log(j)},[j]);const D=async a=>{if(a.length>0){if(c==="weeklytime"){const x={selectedRows:a,type:"approved"};o(E.create({entity:c,jsonData:x}))}else{const x={selectedRows:a,type:"approved"};o(E.updateAll({entity:c,jsonData:x}))}I()}},H=async a=>{if(a.length>0){if(c==="weeklytime"){const x={selectedRows:a,type:"decliend"};o(E.create({entity:c,jsonData:x}))}else{const x={selectedRows:a,type:"decliend"};o(E.updateAll({entity:c,jsonData:x}))}I()}},q=a=>{w(a)};return e.jsxs(e.Fragment,{children:[e.jsx(Ae,{defaultActiveKey:"pending",items:Be,onChange:q}),e.jsxs(Z,{gutter:16,style:{marginBottom:"16px",marginTop:"32px"},children:[e.jsx(f,{span:6,children:e.jsx(z,{label:"TOTAL COUNTS",value:r})}),e.jsx(f,{span:6,children:e.jsx(z,{label:"PRODUCTIVE TIME",value:R})}),e.jsx(f,{span:6,children:e.jsx(z,{label:"UNPRODUCTIVE TIME",value:M})}),e.jsx(f,{span:6,children:e.jsx(z,{label:"NEUTRAL TIME",value:U})})]}),e.jsx(je,{config:u,sidePanelBottomContent:e.jsx(Te,{config:u,formElements:P,withUpload:_}),sidePanelTopContent:e.jsx(Le,{config:u,formElements:B,withUpload:_}),children:e.jsx(Pe,{config:u,handelDataTableLoad:F,selectedListItems:m,approve:D,declien:H,currentStatus:T})})]})},He=we;export{He as A};
