import{aB as L,aC as N,ao as I,a as r,an as e,aK as $,aS as w}from"./index-ewVy9M9d.js";import{aH as _,aO as g,aQ as D,B as T,aU as C,aV as E,aX as b}from"./IdurarOs-eHlzvnv3.js";import{u as B,n as M,p as P,o as v,z as O}from"./ErpApp-7Wu0aHhn.js";import{E as Y}from"./index-IjoPjNv1.js";import{e as x}from"./actions-cTR2S2ig.js";import{a as k,b as H,c as z}from"./selectors-c3wjZmkY.js";import{P as K,F as Q}from"./PaymentForm-exIYBEfe.js";import{c as S}from"./calculate-2yTKWIus.js";import{t as A}from"./statusTagColor-sG5xH6CK.js";import{D as u}from"./index-TnfYKfV7.js";import{C as U}from"./CloseCircleOutlined-QfALGiz_.js";function W({config:c}){const n=L(),s=_();let{entity:a}=c;const i=N(),{isLoading:l,isSuccess:m,current:o}=I(k),[f]=g.useForm(),[t,j]=r.useState(0);r.useEffect(()=>{if(o){const{credit:d,total:p,discount:y}=o;j(S.sub(S.sub(p,y),d))}},[o]),r.useEffect(()=>{m&&(f.resetFields(),i(x.resetAction({actionType:"recordPayment"})),i(x.list({entity:a})),n(`/${a}/`))},[m]);const h=d=>{if(o){const{_id:p}=o,y=o.client&&o.client._id;d={...d,invoice:p,client:y}}i(x.recordPayment({entity:"payment",jsonData:d}))};return e.jsx(D,{isLoading:l,children:e.jsxs(g,{form:f,layout:"vertical",onFinish:h,children:[e.jsx(K,{maxAmount:t}),e.jsx(g.Item,{children:e.jsx(T,{type:"primary",htmlType:"submit",children:s("Record Payment")})})]})})}function X({config:c,currentItem:n}){var p,y;const s=_(),{entity:a,ENTITY_NAME:i}=c,l=B(),m=L(),[o,f]=r.useState([]),[t,j]=r.useState(n),[h,d]=r.useState({});return r.useEffect(()=>{t!=null&&t.client&&d(t.client[t.client.type])},[t]),r.useEffect(()=>{const F=new AbortController;if(n){const{items:R}=n;f(R),j(n)}return()=>F.abort()},[n]),r.useEffect(()=>{console.info("itemslist",o)},[o]),e.jsxs(e.Fragment,{children:[e.jsx(C,{gutter:[12,12],children:e.jsxs(E,{className:"gutter-row",xs:{span:24},sm:{span:24},md:{span:24},lg:{span:20,push:2},children:[e.jsx(M,{onBack:()=>m(`/${a.toLowerCase()}`),title:`Record Payment for ${i} # ${t.number}/${t.year||""}`,ghost:!1,tags:e.jsx(P,{color:(p=A(t.paymentStatus))==null?void 0:p.color,children:t.paymentStatus&&s(t.paymentStatus)}),extra:[e.jsx(T,{onClick:()=>{m(`/${a.toLowerCase()}`)},icon:e.jsx(U,{}),children:s("Cancel")},`${v.generate()}`),e.jsx(T,{onClick:()=>m(`/invoice/read/${t._id}`),icon:e.jsx(Q,{}),children:s("Show Invoice")},`${v.generate()}`)],style:{padding:"20px 0px"}}),e.jsx(b,{dashed:!0})]})}),e.jsxs(C,{gutter:[12,12],children:[e.jsxs(E,{className:"gutter-row",xs:{span:24,order:2},sm:{span:24,order:2},md:{span:10,order:2,push:2},lg:{span:10,order:2,push:4},children:[e.jsx("div",{className:"space50"}),e.jsxs(u,{title:`${s("Client")}  : ${t.client.name}`,column:1,children:[e.jsx(u.Item,{label:s("email"),children:h.email}),e.jsx(u.Item,{label:s("phone"),children:h.phone}),e.jsx(b,{dashed:!0}),e.jsx(u.Item,{label:s("payment status"),children:e.jsx(P,{color:(y=A(t.paymentStatus))==null?void 0:y.color,children:t.paymentStatus&&s(t.paymentStatus)})}),e.jsx(u.Item,{label:s("sub total"),children:l.moneyFormatter({amount:t.subTotal,currency_code:t.currency})}),e.jsx(u.Item,{label:s("total"),children:l.moneyFormatter({amount:t.total,currency_code:t.currency})}),e.jsx(u.Item,{label:s("discount"),children:l.moneyFormatter({amount:t.discount,currency_code:t.currency})}),e.jsx(u.Item,{label:s("Paid"),children:l.moneyFormatter({amount:t.credit,currency_code:t.currency})})]})]}),e.jsx(E,{className:"gutter-row",xs:{span:24,order:1},sm:{span:24,order:1},md:{span:12,order:1},lg:{span:10,order:1,push:2},children:e.jsx(W,{config:c})})]})]})}function q({config:c}){const n=N(),{id:s}=$();let a=I(H(s));r.useEffect(()=>{n(a?x.currentItem({data:a}):x.read({entity:c.entity,id:s}))},[a,s]);const{result:i}=I(z);a=i;const l=m=>{n(O.updateCurrency({data:{default_currency_code:m}}))};return r.useEffect(()=>{n(x.currentAction({actionType:"recordPayment",data:a})),l(a.currency)},[a]),e.jsx(Y,{children:a?e.jsx(X,{config:c,currentItem:i}):e.jsx(w,{})})}function ce(){const c="invoice",n=_(),s={PANEL_TITLE:n("invoice"),DATATABLE_TITLE:n("invoice_list"),ADD_NEW_ENTITY:n("add_new_invoice"),ENTITY_NAME:n("invoice"),RECORD_ENTITY:n("record_payment")},a={entity:c,...s};return e.jsx(q,{config:a})}export{ce as default};
