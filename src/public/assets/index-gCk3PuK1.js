import{an as t,ao as z,a as p,aC as P}from"./index-ewVy9M9d.js";import{C}from"./index-VpG7vA6I.js";import{aO as h,aH as U,aM as V,b2 as w,aK as x,a_ as W,ax as q,aU as H,aV as g}from"./IdurarOs-eHlzvnv3.js";import{u as B,b as $,c as G,T as J}from"./ErpApp-7Wu0aHhn.js";import{P as Q}from"./index-Rolmm9vx.js";import{l as X}from"./config--HMVr5hr.js";import"./Skeleton-a_sn-oBg.js";import"./index-_ks-rlOi.js";const f=({label:s,value:r})=>t.jsx(C,{title:s,bordered:!1,children:t.jsx("p",{className:"text-[green] text-[20px]",children:r})});function Y({config:s,extra:r=[]}){let{lunchEntity:d,dataTableColumns:i,lunchFields:y}=s;const[o]=h.useForm(),T=U(),{moneyFormatter:E}=B(),{dateFormat:I}=$(),c=z(V),[b,u]=p.useState(""),[F,k]=p.useState([]),j=e=>e.userId._id===b,S=()=>{const e=new Date,a=new Date(e);a.setDate(e.getDate()-e.getDay()+(e.getDay()===0?-6:1)),a.setUTCHours(0,0,0,0);const n=new Date(e);return n.setDate(a.getDate()+6),{startDate:a,endDate:n}},_=({editing:e,dataIndex:a,title:n,inputType:l,record:ee,index:te,children:N,...O})=>{const R=l==="number"?t.jsx(W,{}):t.jsx(q,{});return t.jsx("td",{...O,children:e?t.jsx(h.Item,{name:a,style:{margin:0},rules:[{required:!0,message:`Please Input ${n}!`}],children:R}):N})},v=e=>{o.setFieldsValue({mon:"",tue:"",wed:"",thu:"",fri:"",sat:"",sun:"",...e}),console.log(e.userId._id),u(e.userId._id)},A=()=>{u("")},M=async e=>{try{const n=await o.validateFields();n.userId=e.userId._id;const l=e._id;await x.update({entity:d,id:l,jsonData:n}),u(""),o.resetFields(),D()}catch(a){console.log("Validate Failed:",a)}};let m=[];y?m=[...G({fields:y,translate:T,moneyFormatter:E,dateFormat:I})]:m=[...i],i=[...m,{title:"Action",key:"operation",width:140,render:(e,a)=>j(a)?t.jsxs("span",{children:[t.jsx(w.Link,{onClick:()=>M(a),style:{marginRight:8},children:"Save"}),t.jsx(Q,{title:"Sure to cancel?",onConfirm:A,children:t.jsx("a",{children:"Cancel"})})]}):t.jsx(w.Link,{disabled:b!=="",onClick:()=>v(a),children:"Edit"})}],c.role!="owner"&&(i=i.filter(e=>e.key!=="operation"));const D=async()=>{const e=S(),a={userId:c._id,startDate:e.startDate,endDate:e.endDate},n=await x.list({entity:d,options:a});console.log(n==null?void 0:n.result),k(n==null?void 0:n.result)},K=async()=>{const e={userId:c._id};await x.create({entity:d,jsonData:e})};p.useEffect(()=>{const e=new AbortController;return(async()=>{try{await K(),await D()}catch(n){console.error("Error initializing data:",n)}})(),()=>{e.abort()}},[]);const L=i.map(e=>!e||!e.editable?e:{...e,onCell:a=>({record:a,inputType:"number",dataIndex:e.dataIndex,title:e.title,editing:j(a)})});return t.jsx(t.Fragment,{children:t.jsx(h,{form:o,component:!1,children:t.jsx(J,{components:{body:{cell:_}},columns:L,rowKey:e=>e.userId._id,dataSource:F,rowClassName:"editable-row",scroll:{x:!0}})})})}function Z({config:s,withUpload:r=!1}){return P(),t.jsxs(t.Fragment,{children:[t.jsxs(H,{gutter:16,style:{marginBottom:"16px",marginTop:"32px"},children:[t.jsx(g,{span:8,children:t.jsx(f,{label:"Total Members",value:0})}),t.jsx(g,{span:8,children:t.jsx(f,{label:"Total Spent This Week",value:0})}),t.jsx(g,{span:8,children:t.jsx(f,{label:"Total Spent This Month",value:0})})]}),t.jsx(C,{children:t.jsx(Y,{config:s})})]})}function ce(){const r={lunchEntity:"lunch",lunchFields:X};return t.jsx(Z,{config:r})}export{ce as default};
