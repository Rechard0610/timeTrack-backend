import{aC as P,aB as A,ao as I,a as p,aK as N,an as e}from"./index-ewVy9M9d.js";import{d as l,n as Z,p as T,o as b,v as _,z}from"./ErpApp-7Wu0aHhn.js";import{aH as K,aO as F,B as v,aX as Q,aQ as X}from"./IdurarOs-eHlzvnv3.js";import{e as Y}from"./actions-cTR2S2ig.js";import{c as E}from"./calculate-2yTKWIus.js";import{h as G}from"./selectors-c3wjZmkY.js";import{t as L}from"./statusTagColor-sG5xH6CK.js";import{C as J}from"./CloseCircleOutlined-QfALGiz_.js";function W({form:m,translate:x}){const s=()=>{m.submit()};return e.jsx(v,{onClick:s,type:"primary",icon:e.jsx(_,{}),children:x("update")})}function it({config:m,UpdateForm:x}){var j,D;const s=K();let{entity:d}=m;const f=P(),y=A(),{current:r,isLoading:H,isSuccess:S}=I(G),[c]=F.useForm(),[$,h]=p.useState(0),k={status:"",client:{name:"",email:"",phone:"",address:""},subTotal:0,taxTotal:0,taxRate:0,total:0,credit:0,number:0,year:0},[o,q]=p.useState(r??k),{id:C}=N(),w=(t,a)=>{const u=a.items;let n=0;u&&(u.map(i=>{if(i&&i.quantity&&i.price){let g=E.multiply(i.quantity,i.price);n=E.add(n,g)}}),h(n))},B=t=>{let a={...t};if(t&&((t.date||t.expiredDate)&&(a.date=l(t.date).format("YYYY-MM-DDTHH:mm:ss.SSSZ"),a.expiredDate=l(t.expiredDate).format("YYYY-MM-DDTHH:mm:ss.SSSZ")),t.items)){let u=[];t.items.map(n=>{const{quantity:i,price:g,itemName:R,description:U}=n,O=n.quantity*n.price;u.push({total:O,quantity:i,price:g,itemName:R,description:U})}),a.items=u}f(Y.update({entity:d,id:C,jsonData:a}))};p.useEffect(()=>{S&&(c.resetFields(),h(0),f(Y.resetAction({actionType:"update"})),y(`/${d.toLowerCase()}/read/${C}`))},[S]);const M=t=>{f(z.updateCurrency({data:{default_currency_code:t}}))};return p.useEffect(()=>{if(r){q(r);let t={...r};t.date&&(t.date=l(t.date)),t.expiredDate&&(t.expiredDate=l(t.expiredDate)),t.taxRate||(t.taxRate=0),M(r.currency);const{subTotal:a}=t;c.resetFields(),c.setFieldsValue(t),h(a)}},[r]),e.jsxs(e.Fragment,{children:[e.jsx(Z,{onBack:()=>{y(`/${d.toLowerCase()}`)},title:s("update"),ghost:!1,tags:[e.jsx(T,{color:(j=L(o.status))==null?void 0:j.color,children:o.status&&s(o.status)},"status"),o.paymentStatus&&e.jsx(T,{color:(D=L(o.paymentStatus))==null?void 0:D.color,children:o.paymentStatus&&s(o.paymentStatus)},"paymentStatus")],extra:[e.jsx(v,{onClick:()=>{y(`/${d.toLowerCase()}`)},icon:e.jsx(J,{}),children:s("Cancel")},`${b.generate()}`),e.jsx(W,{translate:s,form:c},`${b.generate()}`)],style:{padding:"20px 0px"}}),e.jsx(Q,{dashed:!0}),e.jsx(X,{isLoading:H,children:e.jsx(F,{form:c,layout:"vertical",onFinish:B,onValuesChange:w,children:e.jsx(x,{subTotal:$,current:r})})})]})}export{it as U};
